const check_diabtes = document.getElementById('check-diabetes')
const text_diabtes = document.getElementById('text-diabetes')
check_diabtes.addEventListener('click', function(){
    if(this.checked) {
        text_diabtes.setAttribute("style", 'display:flex')
    }else{
        text_diabtes.setAttribute("style", 'display:none;')
    }
})
const check_presion = document.getElementById('check-presion')
const txt_presion = document.getElementById('txt-presion')
check_presion.addEventListener('click', function(){
    if(this.checked) {
        txt_presion.setAttribute("style", 'display:flex')
    }else{
        txt_presion.setAttribute("style", 'display:none;')
    }
})
const check_chr = document.getElementById('check-chr')
const txt_chr = document.getElementById('txt-chr')
check_chr.addEventListener('click', function(){
    if(this.checked) {
        txt_chr.setAttribute("style", 'display:flex')
    }else{
        txt_chr.setAttribute("style", 'display:none;')
    }
})
const check_mental = document.getElementById('check-mental')
const txt_mental = document.getElementById('txt-mental')
check_mental.addEventListener('click', function(){
    if(this.checked) {
        txt_mental.setAttribute("style", 'display:flex')
    }else{
        txt_mental.setAttribute("style", 'display:none;')
    }
})
const check_epile = document.getElementById('check-epile')
const txt_epile = document.getElementById('txt-epile')
check_epile.addEventListener('click', function(){
    if(this.checked) {
        txt_epile.setAttribute("style", 'display:flex')
    }else{
        txt_epile.setAttribute("style", 'display:none;')
    }
})
const check_asmah = document.getElementById('check-asmah')
const txt_asmah = document.getElementById('txt-asmah')
check_asmah.addEventListener('click', function(){
    if(this.checked) {
        txt_asmah.setAttribute("style", 'display:flex')
    }else{
        txt_asmah.setAttribute("style", 'display:none;')
    }
})
const check_sangui = document.getElementById('check-sangui')
const txt_sangui = document.getElementById('txt-sangui')
check_sangui.addEventListener('click', function(){
    if(this.checked) {
        txt_sangui.setAttribute("style", 'display:flex')
    }else{
        txt_sangui.setAttribute("style", 'display:none;')
    }
})
const check_endo = document.getElementById('check-endo')
const txt_endo = document.getElementById('txt-endo')
check_endo.addEventListener('click', function(){
    if(this.checked) {
        txt_endo.setAttribute("style", 'display:flex')
    }else{
        txt_endo.setAttribute("style", 'display:none;')
    }
})
const check_asmap = document.getElementById('check-asmap')
const txt_asmap = document.getElementById('txt-asmap')
check_asmap.addEventListener('click', function(){
    if(this.checked) {
        txt_asmap.setAttribute("style", 'display:flex')
    }else{
        txt_asmap.setAttribute("style", 'display:none;')
    }
})
const check_alergia = document.getElementById('check-alergia')
const txt_alergia = document.getElementById('txt-alergia')
check_alergia.addEventListener('click', function(){
    if(this.checked) {
        txt_alergia.setAttribute("style", 'display:flex')
    }else{
        txt_alergia.setAttribute("style", 'display:none;')
    }
})
const check_neuro = document.getElementById('check-neuro')
const txt_neuro = document.getElementById('txt-neuro')
check_neuro.addEventListener('click', function(){
    if(this.checked) {
        txt_neuro.setAttribute("style", 'display:flex')
    }else{
        txt_neuro.setAttribute("style", 'display:none;')
    }
})
const check_cardio = document.getElementById('check-cardio')
const txt_cardio = document.getElementById('txt-cardio')
check_cardio.addEventListener('click', function(){
    if(this.checked) {
        txt_cardio.setAttribute("style", 'display:flex')
    }else{
        txt_cardio.setAttribute("style", 'display:none;')
    }
})
const check_hr = document.getElementById('check-hr')
const txt_hr = document.getElementById('txt-hr')
check_hr.addEventListener('click', function(){
    if(this.checked) {
        txt_hr.setAttribute("style", 'display:flex')
    }else{
        txt_hr.setAttribute("style", 'display:none;')
    }
})
const check_infancia = document.getElementById('check-infancia')
const txt_infancia = document.getElementById('txt-infancia')
check_infancia.addEventListener('click', function(){
    if(this.checked) {
        txt_infancia.setAttribute("style", 'display:flex')
    }else{
        txt_infancia.setAttribute("style", 'display:none;')
    }
})
const check_endocrino = document.getElementById('check-endocrino')
const txt_endocrino = document.getElementById('txt-endocrino')
check_endocrino.addEventListener('click', function(){
    if(this.checked) {
        txt_endocrino.setAttribute("style", 'display:flex')
    }else{
        txt_endocrino.setAttribute("style", 'display:none;')
    }
})
const check_fiebre = document.getElementById('check-fiebre')
const txt_fiebre = document.getElementById('txt-fiebre')
check_fiebre.addEventListener('click', function(){
    if(this.checked) {
        txt_fiebre.setAttribute("style", 'display:flex')
    }else{
        txt_fiebre.setAttribute("style", 'display:none;')
    }
})
const check_trauma = document.getElementById('check-trauma')
const txt_trauma = document.getElementById('txt-trauma')
check_trauma.addEventListener('click', function(){
    if(this.checked) {
        txt_trauma.setAttribute("style", 'display:flex')
    }else{
        txt_trauma.setAttribute("style", 'display:none;')
    }
})
const check_trasto = document.getElementById('check-trasto')
const txt_trasto = document.getElementById('txt-trasto')
check_trasto.addEventListener('click', function(){
    if(this.checked) {
        txt_trasto.setAttribute("style", 'display:flex')
    }else{
        txt_trasto.setAttribute("style", 'display:none;')
    }
})
const check_otra = document.getElementById('check-otra')
const txt_otra = document.getElementById('txt-otra')
check_otra.addEventListener('click', function(){
    if(this.checked) {
        txt_otra.setAttribute("style", 'display:flex')
    }else{
        txt_otra.setAttribute("style", 'display:none;')
    }
})
const check_linea = document.getElementById('check-linea')
const txt_linea = document.getElementById('txt-linea')
check_linea.addEventListener('click', function(){
    if(this.checked) {
        txt_linea.setAttribute("style", 'display:flex')
    }else{
        txt_linea.setAttribute("style", 'display:none;')
    }
})
const check_planos = document.getElementById('check-planos')
const txt_planos = document.getElementById('txt-planos')
check_planos.addEventListener('click', function(){
    if(this.checked) {
        txt_planos.setAttribute("style", 'display:flex')
    }else{
        txt_planos.setAttribute("style", 'display:none;')
    }
})
const check_angle = document.getElementById('check-angle')
const txt_angle = document.getElementById('txt-angle')
check_angle.addEventListener('click', function(){
    if(this.checked) {
        txt_angle.setAttribute("style", 'display:flex')
    }else{
        txt_angle.setAttribute("style", 'display:none;')
    }
})
const check_canina = document.getElementById('check-canina')
const txt_canina = document.getElementById('txt-canina')
check_canina.addEventListener('click', function(){
    if(this.checked) {
        txt_canina.setAttribute("style", 'display:flex')
    }else{
        txt_canina.setAttribute("style", 'display:none;')
    }
})
const check_svertical = document.getElementById('check-svertical')
const txt_svertical = document.getElementById('txt-svertical')
check_svertical.addEventListener('click', function(){
    if(this.checked) {
        txt_svertical.setAttribute("style", 'display:flex')
    }else{
        txt_svertical.setAttribute("style", 'display:none;')
    }
})
const check_shorizontal = document.getElementById('check-shorizontal')
const txt_shorizontal = document.getElementById('txt-shorizontal')
check_shorizontal.addEventListener('click', function(){
    if(this.checked) {
        txt_shorizontal.setAttribute("style", 'display:flex')
    }else{
        txt_shorizontal.setAttribute("style", 'display:none;')
    }
})
const check_eprima = document.getElementById('check-eprima')
const txt_eprima = document.getElementById('txt-eprima')
check_eprima.addEventListener('click', function(){
    if(this.checked) {
        txt_eprima.setAttribute("style", 'display:flex')
    }else{
        txt_eprima.setAttribute("style", 'display:none;')
    }
})
const check_efisio = document.getElementById('check-efisio')
const txt_efisio = document.getElementById('txt-efisio')
check_efisio.addEventListener('click', function(){
    if(this.checked) {
        txt_efisio.setAttribute("style", 'display:flex')
    }else{
        txt_efisio.setAttribute("style", 'display:none;')
    }
})
const check_mcruzada = document.getElementById('check-mcruzada')
const txt_mcruzada = document.getElementById('txt-mcruzada')
check_mcruzada.addEventListener('click', function(){
    if(this.checked) {
        txt_mcruzada.setAttribute("style", 'display:flex')
    }else{
        txt_mcruzada.setAttribute("style", 'display:none;')
    }
})
const check_mabierta = document.getElementById('check-mabierta')
const txt_mabierta = document.getElementById('txt-mabierta')
check_mabierta.addEventListener('click', function(){
    if(this.checked) {
        txt_mabierta.setAttribute("style", 'display:flex')
    }else{
        txt_mabierta.setAttribute("style", 'display:none;')
    }
})
const check_malp = document.getElementById('check-malp')
const txt_malp = document.getElementById('txt-malp')
check_malp.addEventListener('click', function(){
    if(this.checked) {
        txt_malp.setAttribute("style", 'display:flex')
    }else{
        txt_malp.setAttribute("style", 'display:none;')
    }
})
const check_diastema = document.getElementById('check-diastema')
const txt_diastema = document.getElementById('txt-diastema')
check_diastema.addEventListener('click', function(){
    if(this.checked) {
        txt_diastema.setAttribute("style", 'display:flex')
    }else{
        txt_diastema.setAttribute("style", 'display:none;')
    }
})
const check_secuencia = document.getElementById('check-secuencia')
const txt_secuencia = document.getElementById('txt-secuencia')
check_secuencia.addEventListener('click', function(){
    if(this.checked) {
        txt_secuencia.setAttribute("style", 'display:flex')
    }else{
        txt_secuencia.setAttribute("style", 'display:none;')
    }
})
const check_perdida = document.getElementById('check-perdida')
const txt_perdida = document.getElementById('txt-perdida')
check_perdida.addEventListener('click', function(){
    if(this.checked) {
        txt_perdida.setAttribute("style", 'display:flex')
    }else{
        txt_perdida.setAttribute("style", 'display:none;')
    }
})
const check_reten = document.getElementById('check-reten')
const txt_reten = document.getElementById('txt-reten')
check_reten.addEventListener('click', function(){
    if(this.checked) {
        txt_reten.setAttribute("style", 'display:flex')
    }else{
        txt_reten.setAttribute("style", 'display:none;')
    }
})
const check_erupcion = document.getElementById('check-erupcion')
const txt_erupcion = document.getElementById('txt-erupcion')
check_erupcion.addEventListener('click', function(){
    if(this.checked) {
        txt_erupcion.setAttribute("style", 'display:flex')
    }else{
        txt_erupcion.setAttribute("style", 'display:none;')
    }
})
const check_proxi = document.getElementById('check-proxi')
const txt_proxi = document.getElementById('txt-proxi')
check_proxi.addEventListener('click', function(){
    if(this.checked) {
        txt_proxi.setAttribute("style", 'display:flex')
    }else{
        txt_proxi.setAttribute("style", 'display:none;')
    }
})
const check_can = document.getElementById('check-cancer')
const txt_can = document.getElementById('text-cancer')
check_can.addEventListener('click', function(){
    if(this.checked) {
        txt_can.setAttribute("style", 'display:flex')
    }else{
        txt_can.setAttribute("style", 'display:none;')
    }
})
const check_infe = document.getElementById('check-infe')
const txt_infe = document.getElementById('txt-infe')
check_infe.addEventListener('click', function(){
    if(this.checked) {
        txt_infe.setAttribute("style", 'display:flex')
    }else{
        txt_infe.setAttribute("style", 'display:none;')
    }
})
const canvas = document.getElementById('canva');
    const context = canvas.getContext('2d');
    let img = new Image();
    img.src = '../iconos/canva.png';
    let lines = [];
    let dibujar = false;
    let currentLine = [];

    img.onload = function() {
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
    };

    function resizeCanvas() {
        const container = document.getElementById('contenedor-canva');
        canvas.width = container.clientWidth;
        canvas.height = (container.clientWidth / 835) * 484;
        context.drawImage(img, 0, 0, canvas.width, canvas.height);
        redrawCanvas(); // Redibujar todo después de redimensionar
    }

    // Eventos de mouse
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);

    // Eventos de touch
    canvas.addEventListener('touchstart', startDrawingTouch);
    canvas.addEventListener('touchmove', drawTouch);
    canvas.addEventListener('touchend', stopDrawing);

    // Obtener la posición del toque
    function getTouchPos(canvas, touchEvent) {
        const rect = canvas.getBoundingClientRect();
        return {
            x: touchEvent.touches[0].clientX - rect.left,
            y: touchEvent.touches[0].clientY - rect.top
        };
    }

    // Iniciar dibujo con mouse
    function startDrawing(event) {
        dibujar = true;
        currentLine = [{ x: event.offsetX, y: event.offsetY }];
        context.beginPath();
        context.moveTo(event.offsetX, event.offsetY);
    }

    // Dibujar con mouse
    function draw(event) {
        if (!dibujar) return;
        currentLine.push({ x: event.offsetX, y: event.offsetY });
        context.lineTo(event.offsetX, event.offsetY);
        context.stroke();
    }

    // Iniciar dibujo con touch
    function startDrawingTouch(event) {
        event.preventDefault();
        dibujar = true;
        const touchPos = getTouchPos(canvas, event);
        currentLine = [{ x: touchPos.x, y: touchPos.y }];
        context.beginPath();
        context.moveTo(touchPos.x, touchPos.y);
    }

    // Dibujar con touch
    function drawTouch(event) {
        event.preventDefault();
        if (!dibujar) return;
        const touchPos = getTouchPos(canvas, event);
        currentLine.push({ x: touchPos.x, y: touchPos.y });
        context.lineTo(touchPos.x, touchPos.y);
        context.stroke();
    }

    // Detener dibujo
    function stopDrawing() {
        if (!dibujar) return;
        dibujar = false;
        context.closePath();
        if (currentLine.length > 0) {
            lines.push({ points: currentLine, color: context.strokeStyle, lineWidth: context.lineWidth });
        }
    }

    // Redibuja todo el canvas, incluida la imagen de fondo
    function redrawCanvas() {
        context.clearRect(0, 0, canvas.width, canvas.height);
        context.drawImage(img, 0, 0, canvas.width, canvas.height);
        lines.forEach(line => {
            context.strokeStyle = line.color;
            context.lineWidth = line.lineWidth;
            context.beginPath();
            const points = line.points;
            context.moveTo(points[0].x, points[0].y);
            for (let i = 1; i < points.length; i++) {
                context.lineTo(points[i].x, points[i].y);
            }
            context.stroke();
        });
    }

    // Botón para deshacer la última línea dibujada
    document.getElementById('undoButton').addEventListener('click', () => {
        if (lines.length > 0) {
            lines.pop(); // Elimina la última línea del array
            redrawCanvas(); // Redibuja el canvas sin la última línea
        }
    });

    // Limpiar todo el canvas
    function clearCanvas() {
        lines = []; // Vaciar todas las líneas
        context.clearRect(0, 0, canvas.width, canvas.height);
        resizeCanvas(); // Volver a dibujar la imagen de fondo
    }

const canvaf = document.getElementById('canva-firma')
const enviar = document.getElementById('crear-expe')
enviar.onclick = async (event) => {
    event.preventDefault();
    
    const data = canvas.toDataURL("image/png");
    const data2 = canvaf.toDataURL("image/png");
    const form = document.getElementById('form-expediente')

    const fd = new FormData(form);
    fd.append("imagen", data);
    fd.append("imagen2", data2);
    
    try {
        const respuestahttp = await fetch("../php/crear-expediente.php", {
            method: "post", 
            body: fd,
        });

        const nombreImagenes = await respuestahttp.json();
        console.log("Imagenes subidas, nombres: " + nombreImagenes);
    } catch (error) {
        console.error("Error al subir las imagenes:", error);
    }
    window.location.reload();
    alert('Expediente registrado exitosamente');
}